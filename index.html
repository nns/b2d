<!doctype html>
<html>
   <head>
      <title>Demo</title>
	   <script src="/socket.io/socket.io.js"></script>
	   <script type="text/javascript">
	   function init(){
	   	var canvas = document.getElementById('canvas');
  		var ctx = canvas.getContext('2d');
  		ctx.strokeStyle = '#eee';
	   	var socket = io.connect();
	   	
	   	var array = [];
	   	socket.on('action',function(data){
	   		array.push(data);
	   	});
	   	setInterval(update,1000/60);
	   	
	  	/*var t = [];
	   	t.push({process:'beginPath'});
	   	t.push({process:'moveTo',args:[20,20]});
	   	t.push({process:'lineTo',args:[120,20]});
	   	t.push({process:'lineTo',args:[120,120]});
	   	t.push({process:'lineTo',args:[20,120]});
	   	t.push({process:'closePath'});
	   	t.push({process:'stroke'});
	   	array.push(t);
	   	update();
	   	*/
	   	function update(){
	   		
	   		var tmp = array.slice(0);
	   		if(tmp.length == 0) return;
		   	tmp.forEach(function(v,i){
		   		ctx.save();
		   		ctx.clearRect.call(ctx,0,0,600,400);
		   		v.forEach(function(vv,ii){
		   			
			   		var data = vv.args;
			   		switch(vv.process){
			   			case 'beginPath':
			   				ctx.beginPath();
			   				break;
			   			case 'moveTo':
			   				ctx.moveTo.apply(ctx,data);
			   				break;
			   			case 'lineTo':
			   				ctx.lineTo.apply(ctx,data);
			   				break;
			   			case 'closePath':
			   				ctx.closePath();
			   				break;
			   			case 'stroke':
			   				ctx.stroke();
			   				break;
			   			case 'fill':
			   				ctx.fill();
			   				break;
			   			case 'arc':
			   				ctx.arc.apply(ctx,data);
			   				break;
			   			case 'clearRect':
			   				ctx.clearRect.apply(ctx,data);
			   				break;
			   			case 'strokeStyle':
			   				ctx.strokeStyle = data;
			   				break;
						case 'fillStyle':
			   				ctx.fillStyle = data;
			   				break;
			   		}
		   		});
		   		ctx.restore();
		   		array.shift();
		   	});
	   	}
	   	
	   }
	   </script>
   </head>
   <body onload="init();" style="margin:0px;">
  	<canvas id='canvas' width="600" height="400" style="background-color:#eee;"></canvas>
   </body>
</html>
